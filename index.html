<!DOCTYPE html>
<html>
    <head>
        <title>Revu</title>
        <script>
            let endpoint = "https://f4do7hzoab.execute-api.sa-east-1.amazonaws.com/default/ec-management"

            let interval;

            function start() {
                console.log("Starting");
                exec("Start");

                if (interval) clearInterval(interval);
                interval = setInterval(function() {
                    let iframe = document.getElementById("iframe");
                        if (iframe.innerHTML) {
                        // get and check the Title (and H tags if you want)
                        var ifTitle = iframe.contentDocument.title;
                        console.log(ifTitle);
                        if ( ifTitle.indexOf("404")>=0 ) {
                            console.log("Not found");
                            clearInterval(interval);
                            interval = undefined;
                            iframe.src = iframe.src;
                        } else {
                            console.log("Found");
                            clearInterval(interval);
                            interval = undefined;
                            element.classList.remove("hidden");
                        }
                    } else {
                        iframe.src = iframe.src;
                        // didn't load
                    }
                }, 3000);
            }

            function stop() {
                console.log("Stopping");
                exec("Stop");
                clearInterval(interval);
            }
            function exec(command) {
                fetch(endpoint, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(command),
                })
                .then(response => response.text())
                .then(response => console.log(response));
            }
        </script>
        <style>
            * {
                margin: 0
            }
            .class hidden {
                display: none
            }
            iframe {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body onload="start()" onunload="stop()">
        <iframe id="iframe" class="hidden" src="https://ps.revu.design" frameBorder="0"></iframe>
    </body>
</html>